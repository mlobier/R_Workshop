---
title       : Introduction to R Workshop 
subtitle    : Session 1
author      : Muriel Lobier
job         : 
framework   : io2012        # {io2012, html5slides, shower, dzslides, ...}
highlighter : highlight.js  # {highlight.js, prettify, highlight}
hitheme     : tomorrow      # 
widgets     : [mathjax, quiz, bootstrap]           # {mathjax, quiz, bootstrap}
mode        : selfcontained # {standalone, draft}
knit        : slidify::knit2slides
---

## Introduction to R for data analysis and visualization

### Workshop agenda

* Scientific data analysis should: 
  * be reproducible 
    * by me
    * by others (if given my code and data)
  * follow rigorous statistical standards
  * use open tools 
  
  
* R is a great way to achieve this


--- .class #id 

## Introduction to R for data analysis and visualization

### Overarching objective: 
* Be able to use R and R-studio to:
  * establish a reproducible and documented data-analysis pipeline

###  Specific Learning goals:
* How to structure a data analysis project
* How to import, clean up and transform data
* How to visualize data and make publication ready figures
* How to run simple inferential statistical analyses
* How to run less-simple inferential statistical analyses

--- .class #id 

## Introduction to R for data analysis and visualization

### Insctructor's philosophy and priors:

* Learning the most efficient tools first is more ... efficient
* Learning to solve problems is more efficient than:
  * reading code written by someone else to solve a fake problem
  * listening to the instructor drone on and on and make bad jokes
* The tidyverse and ggplot are awesome

### What this workshop is not:
* A complete overview of all that R can do
* An R programming course
 

---

## Session 1 - Learning goals

* Using R-Studio
* Your first R Markdown file
* How to structure a data analysis project
* Data strucures in T
* What is Tidy data
* Transforming and restructuring data

---

## R-studio

So let's start by opening R-Studio !!

```{r echo=FALSE, eval=FALSE}
Here we all open R-Studio

We go through the interface together:
  Scripts / Console / ENvironment / History / Files and packages

People should have gone thru a quick online tutorial before so should go fast.
```
---

## R-studio

R can be used as a simple calculator.

```{r}
4+9
```
 You can also make comparisons with R, it will output a boolean
 
```{r}
67 > 52

"Tree" == "tree"
```


---

## R-studio and markdown documents

* Let's now create your first R Markdown documents.

* Markdown documents are great because you can:
  * Combine text and code in the same document: Reproducible Research 
  * Execute parts of the code (code chunks) sequentially for ease of coding
  * ouput a html (or pdf or even .doc) file as your documented analysis.

* Open the pre-templated RMarkdown (.Rmd) file at:
  * ./R_Workshop/my_first_RMarkdown_file.Rmd


---

## R-Markdown

The top part of the file is the YAML header

```{r, eval=FALSE}
---
title: "My first file"
output: html_document
---
```

* R code is inserted in chunks:
* Press the green arrow to execute  

```{r, eval=FALSE}
6*7
```

---

## R-Markdown

The top part of the file is the YAML header

```{r, eval=FALSE}
---
title: "My first file"
output: html_document
---
```

* R code is inserted in chunks:
* Press the green arrow to execute  

```{r}
6*7
```

---

## R-Markdown

* R relies on packages or libraries for added functionality.
* You will need in every R session to load the libraries needed for your analysis.
* Press the green arrow to execute the code and load the *tidyverse* library.


```{r}
library(tidyverse)
```

---

## Inspect data

* We will use a data set included in r calles `iris`. 
* Let's take a look a the first rows of the dataset:
  * Type the command `head(iris)`  in the code chunk below. 
  * Press the green arrow to run the code


```{r,eval=FALSE}
head(iris)
```

---

## Inspect data

* We will use a data set included in r calles `iris`. 
* Let's take a look a the first rows of the dataset:
  * Type the command `head(iris)`  in the code chunk below. 
  * Press the green arrow to run the code


```{r}
head(iris)
```

---

## Inspect data

* Another way to get a "glimpse" of our dataset is to use the `glimpse()` command.
  * excute the code below
  * What additional information did you obtain ??
  

```{r,eval=FALSE}
glimpse(iris)
```

---

## Inspect data

* Another way to get a "glimpse" of our dataset is to use the `glimpse()` command.
  * excute the code below
  * What additional information did you obtain ??
  

```{r}
glimpse(iris)
```

---

## Inspect data

* To learn more about our dataset, we can get a summary:
  * insert a code chunk by clicking on insert/R
  * type and execute the code `summary(iris)`

```{r, eval=FALSE}
summary(iris)
```

---

## Inspect data

* To learn more about our dataset, we can get a summary:
  * insert a code chunk by clicking on insert/R
  * type and execute the code `summary(iris)`

```{r}
summary(iris)
```

---

## Plotting data

You can embed plots in your markdown documents.

* Here we create a plot using ggplot, which we will use throughout the course. 
* We first plot Sepal.Length as a function of each species. 
* We use `geom_point()` to plot a point for each observation. 


```{r, fig.width=12,fig.height=4,fig.align="center",out.width="800px"}
ggplot(iris, aes(x=Species, y=Sepal.Length)) + 
  geom_point()
```

---

## Plotting data

We can also plot directly a boxplot 
  * ggplot computes automatically the median and quartiles of the data.

```{r, fig.width = 8, fig.height= 8, fig.align="center",out.width="380px"}
ggplot(iris, aes(x=Species, y=Sepal.Length)) + 
  geom_boxplot()
```

---

## Plotting data

Modify the code below to plot Petal.Length instead of Sepal.Length

```{r, eval=FALSE}
ggplot(iris, aes(x=Species, y=Sepal.Length)) + 
  geom_boxplot()
```

---

## Plotting data

Modify the code below to plot Petal.Length instead of Sepal.Length

```{r, fig.width = 8, fig.height= 8, fig.align="center",out.width="380px" }
ggplot(iris, aes(x=Species, y=Petal.Length)) + 
  geom_boxplot()
```

---

## Plotting

We can also do a scatterplot of Petal.Length as a function of  Sepal.Length using the  geom_point() command.
* Modify the code below to produce this plot.

```{r , eval = FALSE}
ggplot(iris, aes(x=, y=)) + 
  geom_boxplot()
```

---

## Plotting

We can also do a scatterplot of Petal.Length as a function of Sepal.Length using the  geom_point() command.
* Modify the code below to produce this plot.

```{r, fig.width = 10, fig.height= 8, fig.align="center",out.width="400px" }
ggplot(iris, aes(x=Sepal.Length, y= Petal.Length)) + 
  geom_point()
```

---

## Plotting - adding colors

* The `aes()`  in the `ggplot()` command codes all which 'aesthetics' are assigned to which variable.
* Add a new aesthetics color=Species to the aes() command to add color to your plot

```{r, eval =FALSE}
ggplot(iris, aes(x=Petal.Length, y=Sepal.Length)) + 
  geom_point()
```


---

## Plotting - adding colors

* The `aes()`  in the `ggplot()` command codes all which 'aesthetics' are assigned to which variable.
* Add a new aesthetics color=Species to the aes() command to add color to your plot

```{r , fig.width = 10, fig.height= 8, fig.align="center",out.width="400px" }
ggplot(iris, aes(x=Petal.Length, y=Sepal.Length, color=Species)) + 
  geom_point()
```

---

## Knitting your document into an html file

Now you can press Knit at the top of the script pane to knit and visualize the output html file !!

<iframe src='./assets/img/session_1_knit.png'>
</iframe> 

---

## Important points

* Use RMarkdown documents to combine text, analysis code and figures
* Data structures can be inspected using:
  * `head()`
  * `glimpse()`
  * `summary()`


---

## Quick overview of data types in R

* There are 5 main data types in R
  * numeric doubles : 5.56
  * numeric integers:  2
  * strings/characters: "Hello World"
  * boolean: `TRUE` / `FALSE`
  * complex: 5 + 4.3i

* Other types are:
  * NA
  * Inf

---

## Manipulating types

Evaluate the type of an object
```{r}
typeof(5.3)
```

---

## Manipulating types

Evaluate the type of an object
```{r}
typeof(5.3)
```
test the type of an object
```{r}
is.integer(5.3)
```

---

## Manipulating types

Evaluate the type of an object
```{r}
typeof(5.3)
```
test the type of an object
```{r}
is.integer(5.3)
```
convert the type of an object
```{r}
as.integer(5.3)
```

---

## Vectors

* The simplest object type

```{r}
print(6)
```

* you can concatenate objects into a vector using the `c()` operator
```{r}
c(5, 7, 9, 63)
```

* You can use the `:` operator
```{r}
c(1:10)
```

---

## Vectors

What happens if I mix different data types in my vector ?
```{r, eval=FALSE}
c(6L, "The dog", 56, FALSE)
```

---

## Vectors

What happens if I mix different data types in my vector ?
```{r}
c(6L, "The dog", 56, FALSE)
```

All elements of the vector are *coerced* to the chararcter type. **WITHOUT WARNING**

---

## Vectors

Operations are vectorized
```{r}
c(10,20,30,40) + 1
5^c(1:5)
```

---

## Vector indexing

LETTERS in a built-in vector in R

```{r}
LETTERS
```

---

## Vector indexing

LETTERS in a built-in vector in R

```{r}
LETTERS
```

Calling an element in done using the `[]` operator
```{r}
LETTERS[2]
```

---

## Vector indexing

Index the vector to ouput your name...

```{r, eval=FALSE}
LETTERS[]
```

**TIP**

Remember the difference between 

```{r, eval=FALSE}
2,5,7,10
```
and 
```{r}
c(2,5,7,10)
```

---

## Vector indexing

Index the vector to ouput your name...

```{r}
LETTERS[c(13, 25, 13, 25)]
```

---

## Vector indexing

You can use the `` operator to index a vector

```{r}
LETTERS[1:5]
```

The function `length()` returns ... the length of your vector
```{r}
length(LETTERS)
```

---

## Vector indexing: exercises

How do I get this ouput:
```{r,echo=FALSE}
LETTERS[5:10]
```
How do I get this ouput:
```{r,echo=FALSE}
LETTERS[c(5:10, 17)]
```
How do I ouput the first 3 letters and the second to last one:
```{r,echo=FALSE}
LETTERS[c(1:3, length(LETTERS)-1)]
```
How do I ouput all letters except M and Y (*negative indexes ??*):
```{r,echo=FALSE}
LETTERS[c(1:3, length(LETTERS)-1)]
```

---

## Vector indexing: exercises

How do I get this ouput:
```{r}
LETTERS[5:10]
```
How do I get this ouput:
```{r}
LETTERS[c(5:10, 17)]
```

---

## Vector indexing: exercises
How do I ouput the first 3 letters and the second to last one:
```{r,echo=FALSE}
LETTERS[c(1:3, length(LETTERS)-1)]
```
How do I ouput all letters except M and Y (*negative indexes ??*):
```{r,echo=FALSE}
LETTERS[c(1:3, length(LETTERS)-1)]
```


---

## Vector indexing: exercises
How do I ouput the first 3 letters and the second to last one:
```{r,echo=FALSE}
LETTERS[c(1:3, length(LETTERS)-1)]
```
How do I ouput all letters except M and Y (*negative indexes ??*):
```{r,echo=FALSE}
LETTERS[c(1:3, length(LETTERS)-1)]
```

---

## Vectors and Lists

![image](assets/img/session_1_vectors.png)

source: **H. Wickham** - [*R* for data science](http://r4ds.had.co.nz/vectors.html)


---

<iframe src='./assets/img/session_1_vectors.png'>
</iframe> 

--- &twocol

## Problem to solve Nb 1

We have acquired data on a Posner-like stimulus detection and discrimination task. 
*** =left

<iframe src='./assets/img/session_1_paradigm.png'>
</iframe> 

*** =right
Independent variables: 
* Attention :
  * Left / Right
* Stimulus contrast :
  * Low / High
* Stimulus validity:
  * Valid / Invalid
  
Dependent variables:
* RT
* Detection rate
* Discrimination rate

---

## The problem we want to solve

Go from this:

<iframe src='./assets/img/session_1_folders.png'>
</iframe> 



---

## The problem we want to solve

To this:

<iframe src='./assets/img/session_1_final_objective.svg'>
</iframe> 

---
## Step 1: create a project folder structure

Project directories should be organized consistently and methodically. My preferred structure would be:

project_name/ (root directory)
* name_of_analysis.Rmd (Rnotebook with main analysis code)
* R/ (fproject-specific R function files)
* data/ (original data - READ ONLY)
* figs/ (figures generated by my code)
* output/ (processed or simulated data, other non-final output )

**Create your own project directory structure now**

---

## Step 2: create R Notebook for our analysis

Notebooks are great because you can:
* combine text and code in the same document
* execute blocks of code sequentially to build your analysis step by step
* save the ouput as:
  * a notebook file .nb.html
  * a browser-friendly html file (or pdf, word....)

```{r echo=FALSE, eval=FALSE}
Everybody goes to Create File, new R note Book

```
<iframe src='./assets/img/session_1_RNotebook.png'>
</iframe> 

---

## Step 2: create R Notebook for our analysis

* **Save your R notebook in your project root directory**

* Remember to modify the title of the notebook header to a descriptive title

* You can 
  * execute a chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 
  * add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*
  * preview the ouput files by pressing preview
  
* R notebooks use Markdown syntax. A helful cheatsheet is here.

---
## Step 3: Download the data

* Dowload the data from google drive to a /data/behav/ directory.

* Remember to have a different folder for each subject.

---

## Importing data


* First we load the tidyverse library

* What is tidyverse? It's **AWESOME** as you can see [here](http://tidyverse.org/)

So we first load the tidyverse library which will load most of the 'verse...
```{r}
library(tidyverse)
```

---

## Importing data

In the `R_Workshop_exercises` directory, open the `importing_csv_files.R' script.

* Carry out PART 1


---

## Importing data

In the `data\exercises\session_1` directory, there are several data files.

```{r}
list.files("data/exercises/session_1")
```

* These files can all be read by one of the following readr functions with the proper parameters:

  * `read_csv()`  -  `read_csv2()`  - `read_tsv()`  - `read_delim()`
  
1. Use the help function ? to see the difference between these functions 
2. Open the data_1.csv file with a text editor to figure our the best function 
3. Try to import data_1.csv into variable data_1 `data_1<-read_xxx()`     
4. look at the **Environment** tab in the upper right pane to see what your data looks like

---

## Importing data

* Data_1.csv is a standard *comma-separated* flat data file 
  * We can use `read_csv()` to import it
  * We **assign** the data to a variable  *data_1* using the `<-` operator
  * *data_1* should now have appeared in the top-right **Environment** pane


```{r, eval=FALSE}
data_1<-read_csv("data/Exercises/session_1/data_1.csv")

```

---



## Importing data

```{r, eval=TRUE, warning=FALSE}
data_1<-read_csv("data/Exercises/session_1/data_1.csv")
```

---

## Importing data

```{r, eval=TRUE, message=FALSE}
data_1<-read_csv("data/Exercises/session_1/data_1.csv")
```

---

## Importing data

```{r, eval=TRUE, warning=FALSE, message=FALSE}
data_1<-read_csv("data/Exercises/session_1/data_1.csv")
data_1
```

---

## Importing data - Dataframes or tibbles

```{r, eval=FALSE, echo=FALSE}
# Here we discuss the dataframe and tibble structures as well as the head() command.
```

```{r, eval=TRUE, warning=FALSE, message=FALSE}
head(data_1)
```

---

## Importing data

* Find the appropriate function to import each remaining file to a data structure
* Assign the files to names relevant to the file (i.e. data_2, etc.)
* The data is the same, so check that the data structures you obtain are in fact the same

---

## Inspecting data

* the `summary()` function can give us a quick look at our data

```{r}
summary(data_1)
```

---


## Inspecting data

* the `names()` function returns a vector of our variable names

```{r}
names(data_1)
```

---

## Inspecting data

* the `$` operator allows us to call a single variable of our dataframe/tibble

```{r}
data_1$trialNb
```

---

## Inspecting data

* the `$` operator allows us to call a single variable of our dataframe/tibble
* we can then apply a function on the output vector like the mean stimulus duration

```{r}
mean(data_1$stimDuration)
```


---

## Inspecting data

* Try computing the mean response reaction time

```{r}
mean(data_1$responseRT)
```

* What is the problem ?

---

## Inspecting data

```{r}
data_1$responseRT
```

---

## Inspecting data

```{r}
data_1$responseRT
```

```{r}
mean(data_1$responseRT, na.rm=TRUE)
```

---

## Cleaning up the data - renaming - recoding

```{r}
head(data_1)
```

---

## Cleaning up the data - renaming - recoding

```{r}
data_1[1:10,]$taskType
```

* rename a variable:
 * taskType -> Contrast
* recode the values 
  * detection -> low
  * discrimintation -> high
  
